{% extends "layout_restauracja.html" %}

{% block head %}
{{ super() }}

{% endblock %}

{% block content %}
<div class="row" style="margin-top:20px;">
	<div class="col">
	</div>
	<div class="col-9">
		<table id="menu" class="table table-striped" style="margin-top:30px;">
			<thead>
				<tr>
					<th scope="col" style="width: 35%"></th>
					<th scope="col" style="width: 15%">Cena</th>
					<th scope="col" style="width: 25%">Opis</th>
					<th scope="col" style="width: 25%"></th>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
	<div class="col">
	</div>
</div>

<div class="row">
	<div class="col">
	</div>
	<div class="col-9" id="formLink">
		<a class="btn btn-outline-primary" role="button" href="{{ url_for('formularz_potrawy_restauracji.wyswietl_formularz', restaurant_id=restaurant_id) }}">Dodaj
			potrawę</a>
	</div>
	<div class="col">
	</div>
</div>
{% endblock content %}

{% block scripts %}
{{ super() }}
<script type="text/javascript">
	$(document).ready(function () {
		get_dishes();
	});

	function get_dishes() {
		var host = "http://{{ config.BACKEND_HOST }}";
		var port = "{{ config.BACKEND_PORT }}";
		var endpoint = "/pobierz_menu_restauracji";
		$.ajax({
			type: "GET",
			url: host + ":" + port + endpoint,
			data: { "id_restauracji": {{ restaurant_id }} },
			success: function (json_obj) {
				//json_obj = $.parseJSON(json);
				console.log(json_obj);
				$('#menu').children('tbody').empty();
				var menu_list = json_obj['lista'];
				$.each(menu_list, function (i, menu_item) {
					var row = '<tr id="' + menu_item.id_dania + '">';
					row += '<td>' + menu_item.nazwa + '</td>';
					row += '<td>' + menu_item.cena + '</td>';
					row += '<td>' + menu_item.opis + '</td>';
					row += '<td>' + '<button onClick="delete_dish(this)" type="button" class="btn btn-outline-danger">Usuń</button>' + '</td>';
					row += '</tr>'
					$('#menu').children('tbody').append(row);
				});
			}
		});
	}

	function delete_dish(btn) {
		var row = btn.parentNode.parentNode;
		var dish_id = row.id;
		var dish_name = row.children[0].textContent;
		var confirmed = confirm("Usunąć " + dish_name + "?");
		if(confirmed) {
			var host = "http://{{ config.BACKEND_HOST }}";
			var port = "{{ config.BACKEND_PORT }}";
			var endpoint = "/usun_danie";
			$.ajax({
				type: "GET",
				url: host + ":" + port + endpoint,
				data: { 
					"id_restauracji": {{ restaurant_id }},
					"id_dania": dish_id 
				},
				success: function (json_obj) {
					//json_obj = $.parseJSON(json);
					console.log(json_obj);
					get_dishes();
				}
			});
		}
	}
</script>

{% endblock %}